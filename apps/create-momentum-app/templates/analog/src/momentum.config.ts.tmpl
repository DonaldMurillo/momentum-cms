import 'dotenv/config';
import { defineMomentumConfig } from '@momentumcms/core';
{{dbImport}}
import { momentumAuth } from '@momentumcms/auth';
import { localStorageAdapter } from '@momentumcms/storage';
import { seoPlugin } from '@momentumcms/plugins-seo';
import { join } from 'node:path';
import { Posts } from './collections/posts.collection';

const dbAdapter = {{dbAdapter}};

{{dbPoolSetup}}

const authBaseURL =
	process.env['BETTER_AUTH_URL'] || `http://localhost:${process.env['PORT'] || {{defaultPort}}}`;

export const authPlugin = momentumAuth({
	{{authDbConfig}}
	baseURL: authBaseURL,
	trustedOrigins: [authBaseURL],
	email: {
		appName: '{{projectName}}',
	},
});

/**
 * SEO plugin - generates sitemap.xml, robots.txt, and meta tag API.
 */
export const seo = seoPlugin({
	collections: ['posts'],
	siteUrl: `http://localhost:${process.env['PORT'] || {{defaultPort}}}`,
	analysis: true,
	sitemap: true,
	robots: true,
	metaApi: true,
	adminDashboard: true,
});

const config = defineMomentumConfig({
	db: { adapter: dbAdapter },
	collections: [Posts],
	storage: {
		adapter: localStorageAdapter({
			directory: join(process.cwd(), 'data', 'uploads'),
		}),
	},
	admin: {
		basePath: '/admin',
		branding: {
			title: '{{projectName}}',
		},
	},
	server: {
		port: Number(process.env['PORT']) || {{defaultPort}},
		cors: {
			origin: process.env['CORS_ORIGIN'] || '*',
			methods: ['GET', 'POST', 'PATCH', 'PUT', 'DELETE', 'OPTIONS'],
			headers: ['Content-Type', 'Authorization', 'X-API-Key'],
		},
	},
	plugins: [seo, authPlugin],
});

export default config;
