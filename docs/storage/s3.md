# S3 Storage Adapter

Store uploads in Amazon S3 or any S3-compatible service (MinIO, DigitalOcean Spaces, etc.).

## Setup

```bash
npm install @aws-sdk/client-s3 @aws-sdk/s3-request-presigner
```

```typescript
import { s3StorageAdapter } from '@momentum-cms/storage';

export default defineMomentumConfig({
	storage: {
		adapter: s3StorageAdapter({
			bucket: 'my-bucket',
			region: 'us-east-1',
		}),
	},
});
```

## Options

| Option               | Type      | Default     | Description                                                                     |
| -------------------- | --------- | ----------- | ------------------------------------------------------------------------------- |
| `bucket`             | `string`  | required    | S3 bucket name                                                                  |
| `region`             | `string`  | required    | AWS region                                                                      |
| `accessKeyId`        | `string`  | env var     | AWS access key (falls back to `AWS_ACCESS_KEY_ID`)                              |
| `secretAccessKey`    | `string`  | env var     | AWS secret key (falls back to `AWS_SECRET_ACCESS_KEY`)                          |
| `endpoint`           | `string`  | —           | Custom endpoint for S3-compatible services                                      |
| `baseUrl`            | `string`  | —           | Custom public URL (CDN, custom domain)                                          |
| `forcePathStyle`     | `boolean` | `false`     | Use path-style URLs (required for MinIO)                                        |
| `acl`                | `string`  | `'private'` | Object ACL: `private`, `public-read`, `public-read-write`, `authenticated-read` |
| `presignedUrlExpiry` | `number`  | `3600`      | Presigned URL expiry in seconds                                                 |

## Examples

### Amazon S3

```typescript
s3StorageAdapter({
	bucket: 'my-cms-uploads',
	region: 'us-east-1',
	acl: 'public-read',
});
```

### MinIO

```typescript
s3StorageAdapter({
	bucket: 'uploads',
	region: 'us-east-1',
	endpoint: 'http://localhost:9000',
	forcePathStyle: true,
	accessKeyId: 'minioadmin',
	secretAccessKey: 'minioadmin',
});
```

### DigitalOcean Spaces

```typescript
s3StorageAdapter({
	bucket: 'my-space',
	region: 'nyc3',
	endpoint: 'https://nyc3.digitaloceanspaces.com',
	acl: 'public-read',
});
```

## Presigned URLs

For private buckets, use presigned URLs to grant temporary access:

```typescript
const adapter = s3StorageAdapter({
	bucket: 'private-bucket',
	region: 'us-east-1',
	acl: 'private',
	presignedUrlExpiry: 3600, // 1 hour
});

// Generate a temporary URL
const url = await adapter.getSignedUrl('uploads/photo.jpg', 900); // 15 minutes
```

## How It Works

- AWS SDK is lazy-loaded (only imported when the adapter is used)
- Files are stored with UUID filenames preserving the original extension
- Public URL format: `https://{bucket}.s3.{region}.amazonaws.com/{key}`
- Credentials can come from config or standard AWS environment variables

## Related

- [Storage Overview](overview.md) — Adapter interface
- [Local Adapter](local.md) — Filesystem alternative
